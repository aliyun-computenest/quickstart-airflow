# Harbor计算巢快速部署

>**免责声明：**本服务由第三方提供，我们尽力确保其安全性、准确性和可靠性，但无法保证其完全免于故障、中断、错误或攻击。因此，本公司在此声明：对于本服务的内容、准确性、完整性、可靠性、适用性以及及时性不作任何陈述、保证或承诺，不对您使用本服务所产生的任何直接或间接的损失或损害承担任何责任；对于您通过本服务访问的第三方网站、应用程序、产品和服务，不对其内容、准确性、完整性、可靠性、适用性以及及时性承担任何责任，您应自行承担使用后果产生的风险和责任；对于因您使用本服务而产生的任何损失、损害，包括但不限于直接损失、间接损失、利润损失、商誉损失、数据损失或其他经济损失，不承担任何责任，即使本公司事先已被告知可能存在此类损失或损害的可能性；我们保留不时修改本声明的权利，因此请您在使用本服务前定期检查本声明。如果您对本声明或本服务存在任何问题或疑问，请联系我们。


## 概述

Apache Airflow 是一个开源的工作流管理平台，用于编写、调度和监控工作流（Workflows）。它最初由 Airbnb 开发，并于 2016 年捐赠给 Apache 软件基金会。Airflow 的核心理念是通过代码来定义工作流，使得工作流的管理和维护更加灵活和可扩展。

## 计费说明

部署Airflow的费用主要涉及：

- 所选vCPU与内存规格
- 系统盘类型及容量
- 公网带宽
- Kubernetes集群规格

## 部署架构

<img src="Architecture.png" width="1500" height="700" align="bottom"/>

## 参数说明

| 参数组          | 参数项          | 说明                                               |
|--------------|--------------|--------------------------------------------------|
| 服务实例         | 服务实例名称       | 长度不超过64个字符，必须以英文字母开头，可包含数字、英文字母、短划线（-）和下划线（_）    |
|              | 地域           | 服务实例部署的地域                                        |
| 容器集群选项       | 集群选项         | 是否新建集群或使用已有集群                                    |                                          |
| 付费类型配置       | 付费类型         | 资源的计费类型：按量付费和包年包月                                |
| Kubernetes配置 | Worker节点规格   | ACK集群节点规格                                        |
|              | 实例节点数        | ACK集群节点个数                                        |
|              | Worker 系统盘磁盘类型 | ACK集群节点挂载系统盘类型                                   |
|              | Worker节点系统盘大小(GB) | ACK集群节点挂载系统盘大小                                   |
|              | ack网络插件      | Flannel 或 Terway                                 |
|              | Service CIDR | 不能与 VPC 及 VPC 内已有 Kubernetes 集群使用的网段重复。创建成功后不能修改 |
| Helm配置       | Chart values| helm部署参数内容                                       |
| 基础配置         | 可用区| 节点部署所在可用区                                        |
|              | 选择已有/新建的专有网络| 资源所在专有网路                                         |
|              | 专有网络IPv4网段| 专业网络IPv4网段                                       |                                          |
|              | 交换机子网网段| 必须属于VPC的子网段。                                     |  

## RAM账号所需权限

部署Airflow，需要对部分阿里云资源进行访问和创建操作。因此您的账号需要包含如下资源的权限。
  **说明**：当您的账号是RAM账号时，才需要添加此权限。

| 权限策略名称                          | 备注                                 |
|---------------------------------|------------------------------------|
| AliyunECSFullAccess             | 管理云服务器服务（ECS）的权限                   |
| AliyunVPCFullAccess             | 管理专有网络（VPC）的权限                     |
| AliyunROSFullAccess             | 管理资源编排服务（ROS）的权限                   |
| AliyunComputeNestUserFullAccess | 管理计算巢服务（ComputeNest）的用户侧权限         |
| AliyunPostGreSQLFullAccess      | 管理云数据库服务（PostGreSQL）的权限            |
| AliyunSLBFullAccess             | 管理负载均衡（SLB）的权限                     |

## 部署流程

1.访问Airflow服务[部署链接](https://computenest.console.aliyun.com/service/instance/create/cn-hangzhou?type=user&ServiceId=service-2b7575c1f3d74026aec5)
，按提示填写部署参数, 这里可以根据需求对Chart Values进行修改：

![image.png](1.png)

2.确认订单完成后同意服务协议并点击**立即创建**进入部署阶段。

![image.png](4.png)

4.等待部署完成后进入服务实例管理。

5.在控制台找到Harbor服务链接并访问。

![image.png](5.png)
![image.png](6.png)
